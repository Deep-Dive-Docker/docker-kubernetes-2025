## Docker Networks 소개

### 네트워크란?

- 여러 컨테이너 간의 통신을 허용하는 것
- 본질적으로 노드 웹 API 컨테이너와 MongoDB 컨테이너가 존재

### 도커로 네트워크 사용

- `docker run` 명령에 `--network` 옵션 추가
    
    → 모든 컨테이너가 서로 통신할 수 있는 네트워크가 생성됨
    
- 네트워크 옵션 추가 시 IP 조회 및 해결 작업을 자동으로 수행
    - 고유한 임무와 작업을 가진 다수의 격리된 컨테이너를 가짐
    - 그 컨테이너들은 서로 통신이 가능함

### 도커에서 네트워크 활용하기

- 모든 컨테이너 중지 후 네트워크 옵션을 추가하여 실행해보기
    1. 기본 명령어인 `docker run -d --name mongodb`에서 `--network [네트워크 이름]` 옵션을 추가
        
        → 실행 불가
        
    2. 실행 할 컨테이너 중지 후 `docker container prune`을 실행하여 중지된 모든 컨테이너 제거
    3. 이후 실행 할 컨테이너 다시 실행
    4. 그러나 `--network` 옵션으로 실행하기 위해 Enter 키 클릭 시 오류 발생(’favorites-net’ 네트워크를 찾을 수 없습니다)
- **에러가 발생하는 이유**
    - 볼륨과 달리 네트워크의 경우 자동으로 볼륨을 생성하지 않음
    - 네트워크를 사용하여 컨테이너를 실행하려면 직접 컨테이너를 만들어야 함
        - 새롭게 시작된 컨테이너 제거 (네트워크 탐색을 실패해서 중지되었기 때문)
        - 제거 후 `docker network` 명령으로 네트워크 생성
        - `docker network create [네트워크 이름]`로 새로운 도커 네트워크 생성
        - `docker network ls`를 사용하여 기존의 모든 네트워크 검사:
            
            자신의 네트워크를 볼 수 있을 뿐만 아니라 내장된 몇 가지 디폴트 네트워크도 확인 가능
            
    - `docker run mongodb` 명령 다시 시도해보기 (`--network [네트워크 이름]` 플래그로 방금 설정한 네트워크 사용)

### 여러 네트워크 사용

- 두 개의 컨테이너가 동일한 네트워크 일부분인 경우 다른 컨테이너 이름을 경로에 입력 가능
    
    ```jsx
    mongoose.connect(
    	// 'mongodb://172.17.0.2:27017/swfavorites',
    	'mongodb://mongodb:27017/swfavorites',
    	// ...
    )
    ```
    
    - 컨테이너 이름으로 입력 가능
- 업데이트 된 코드 저장 후 이미지 리빌드
- 노드 애플리케이션 생성:  `docker run --name [네트워크 이름] -d --rm`
- 포트 노출시키기 (중요)
- mongodb 컨테이너와 동일한 네트워크로 컨테이너를 집어넣기 위해 플래그 설정
    - `--network` 옵션에 `favorites-net` 입력

## Docker가 IP 주소를 해결하는 방법

- 다중 컨테이너는 동일한 네트워크에 존재할 수 있음
- 실제로 컨테이너 이름을 도메인으로 사용 가능
    
    → 그럼 도커가 ip 주소를 자동으로 해결함. 이런 기능임.
    

### **! 도커는 소스 코드를 내부적으로 교체하지 않음.**

- 도커의 역할은 그것이 아니라 도커는 하는 것이 아님.
- 즉, 소스 코드를 대체하지 않음 = 소스 코드를 읽지 않음
- 컨테이너의 이름을 보고, 코드에 플러그인된 컨테이너의 ip 주소를 연결함.
- 도커는 애플리케이션이 실행되는 환경을 소유하고 애플리케이션이 http 요청이나 mongoDB 요청 또는 컨테이너에서 다른 종류의 요청을 보내는 경우에 도커가 이를 인식함.
    
    → 이 시점에 도커는 주소, 컨테이너 이름 또는 host.docker.internal을 실제 ip 주소로 바꿈.
    
- 도커가 하는 이유 : 주변의 컨테이너와 호스트 머신을 알고 있습니다.
- 자동 ip 변환이 발생되는 이유 : 컨테이너에서 요청을 전송할 때만.
- 요청이 컨테이너에서 전송되는 않거나 and 요청이 다른 곳
    
    ※ **요청이 다른 곳이란?** 
    
    브라우저에서 생성된 경우에는 사용자가 웹 앱을 방문하여 javaScript 코드가 브라우저에서 실행 중이고, 그 브라우저에서 요청이 전송되면 도커는 아무 작업도 수행하지 않음.
    

### 추가로 공부하면 좋을 것

자동 IP 변환 기능이 실질적으로 내부적으로 어떻게 작동되는지 이해를 잘 하는 것이 중요한 포인트
