## 바인드 마운트 시작하기

### 바인드 마운트(Bind Mounts)

- 실행 중인 애플리케이션의 소스 코드 변경 시 이미지를 로드하지 않는 한 실행 중인 컨테이너에 반영되지 않음 (2주차 이미지 레이아웃 관련 문서 참고)
- 이미지를 다시 로드하는 번거로움을 해결하도록 도와주는 것이 **바인드 마운트(Bind Mount)**
- 볼륨과 바인드 마운트의 차이점
    - 볼륨: 도커에 의해 관리되는 볼륨의 위치 즉, 호스트 머신의 파일 시스템 상의 볼륨이 어디에 있는지 실제로 확인 불가능
    - 바인드 마운트: 바인드 마운트는 확인 가능. 개발자로서 호스트 머신 상에 매핑될 컨테이너의 경로를 설정하기 때문

→ 따라서 바인드 마운트를 사용하여 로컬 호스트 머신 상의 경로 인식 가능 

→ 이후 컨테이너는 이를 인식하여 소스 코드를 실제로 스냅샷에서 복사하는 것이 아닌 **바인딩 마운트에서 복사** (연결된 폴더: 호스트 머신의 어떤 폴더. 따라서 항상 최신 코드에 엑세스 가능)

→ 스냅샷뿐만 아니라 처음에 이미지 생성 시 그 이미지에도 넣음

- 편집이 불가능한 명명된 볼륨과 달리 바인드 마운트는 영구적이고 편집 가능한 데이터

### 바인드 마운트 추가

- 컨테이너 실행 시 터미널 내부에서 바인드 마운트 설정
- `docker run`을 사용하여 새 컨테이너 생성
- 추가적으로 볼륨 추가(명명된 볼륨, 추가적인 볼륨): `-v`로 추가
- ‘app’ 폴더 제어: `"[프로젝트 폴더 경로]:/app" feedback-node:volumns`
    - 큰따옴표로 묶는 이유: 특수 문자나 공백이 포함된 경우, 깨지지 않도록 하기 위함
- **중요 참고사항**
    - 바인딩 마운트로 공유 중인 폴더에 도커가 액세스할 수 있는지 반드시 확인해야 함
    1. 도커의 ‘Preferences(기본 설정)’ 액세스를 통해 수행
    2. ‘Resources-File sharing’ 클릭
    3. 지금 공유하고 있는 폴더가 리스팅 되는지 확인
    4. 만약 ‘Resources’아래에 ‘File sharing’ 메뉴가 없을 시 Window 확인

### Docker Toolbox에서 다른 폴더 공유 시

> https://headsigned.com/posts/mounting-docker-volumes-with-docker-toolbox-for-windows/ 참고
> 
- 컨테이너 볼륨에 사용하기로 지정된 폴더에 자기 로컬 호스트 시스템 머신으로 도커가 실제 사용 가능한지 확인

### 바인드 마운드 - 바로가기 (Shortcuts)

- macOS / Linux: `-v $(pwd):/app`
- Windows: `-v "%cd%":/app`

## 다른 볼륨 결합 & 병합하기

- 문제점 예) 공유 중인 프로젝트가 User 디렉토리의 하위 폴더에 있을 때 액세스
    - 공유 중인 프로젝트 또는 그 상위 폴더를 ‘Prefereneces’ 메뉴 리스트에 공유 가능 리소스로 추가
    - 사용 중인 터미널로 돌아가 Enter 키를 누르면 컨테이너 재실행 됨
    - 컨테이너 내부의 ‘app’ 폴더에 명명된 볼륨으로 마운트 됨 (**리로드 시 충돌 발생**)
    - 이후 실행 중인 컨테이너와 종료된 컨테이너 검사 시, 종료된 컨테이너는 자동으로 제거됨(실행 즉시 종료되는 것처럼 보임)
- 새로 추가한 바인드 마운트의 문제
    - 컨테이너 내부의 ‘app’ 폴더를 로컬 폴더로 덮어쓰지 X
    - 처음 이미지 생성 시 ‘app’ 폴더에 모두 복사
    - 각 파일은 패키지 등을 필요로 하며 그것은 컨테이너에 존재
    - 그러나 로컬 폴더에 npm install을 하지 않았기 때문
- 해결 방법
    - `-v`를 하나 더 추가하여 또다른 볼륨으로 해결
    - `/app/node_modules` 폴더 바인딩으로 해결 (**익명 볼륨 추가**)
